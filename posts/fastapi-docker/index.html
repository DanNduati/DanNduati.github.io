<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Daniel Chege Nduati"><meta name=description content="APIs and FastAPI Creating APIs, or application programming interfaces, is an important part of making your software accessible to a broad range of users. FastAPI is a high-performance API based on Pydantic and Starlette. It is an awesome modern Python framework designed to enable developers to quickly build robust and high performance APIs.
Why FastAPI? Some of the really cool features of fast api can be found in the frameworks official website."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Getting Started with Fast API and Docker"><meta name=twitter:description content="APIs and FastAPI Creating APIs, or application programming interfaces, is an important part of making your software accessible to a broad range of users. FastAPI is a high-performance API based on Pydantic and Starlette. It is an awesome modern Python framework designed to enable developers to quickly build robust and high performance APIs.
Why FastAPI? Some of the really cool features of fast api can be found in the frameworks official website."><meta property="og:title" content="Getting Started with Fast API and Docker"><meta property="og:description" content="APIs and FastAPI Creating APIs, or application programming interfaces, is an important part of making your software accessible to a broad range of users. FastAPI is a high-performance API based on Pydantic and Starlette. It is an awesome modern Python framework designed to enable developers to quickly build robust and high performance APIs.
Why FastAPI? Some of the really cool features of fast api can be found in the frameworks official website."><meta property="og:type" content="article"><meta property="og:url" content="/posts/fastapi-docker/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-11T18:33:35+03:00"><meta property="article:modified_time" content="2022-08-11T18:33:35+03:00"><title>Daniel Nduati</title><link rel=canonical href=/posts/fastapi-docker/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.6b1a4fbc48955b72aea7913e43fabeb45e8bc120da5aa41b598dd33adcac4b59.css integrity="sha256-axpPvEiVW3Kup5E+Q/q+tF6LwSDaWqQbWY3TOtysS1k=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css integrity="sha256-OeQafxa9+MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.101.0"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Daniel Nduati</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/contact/>Contact</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=/posts/fastapi-docker/>Getting Started with Fast API and Docker</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-08-11T18:33:35+03:00>August 11, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
9-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/python/>python</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/fastapi/>fastapi</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/docker/>docker</a></span></div></div></header><div><figure><img src=/fastapi-docker/fastapi.png alt=fastapi></figure><h2 id=apis-and-fastapi>APIs and FastAPI
<a class=heading-link href=#apis-and-fastapi><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Creating APIs, or application programming interfaces, is an important part of making your software accessible to a broad range of users. FastAPI is a high-performance API based on Pydantic and Starlette. It is an awesome modern Python framework designed to enable developers to quickly build robust and high performance APIs.</p><h2 id=why-fastapi>Why FastAPI?
<a class=heading-link href=#why-fastapi><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Some of the really cool features of fast api can be found in the frameworks <a href=https://fastapi.tiangolo.com/>official website</a>. Besides all that the feature i really like about FastAPI is the automatic interactive API documentation provided by both swagger ui and ReDoc</p><h2 id=installation-and-setup>Installation and Setup
<a class=heading-link href=#installation-and-setup><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Create our project directory</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir fastapi_learn &amp;&amp; cd fastapi_learn
</span></span></code></pre></div><p>Once inside the project directory create an <code>app</code> directory and enter it. Create an an empty file <code>__init__.py</code> and <code>main.py</code></p><p>You should have a directory structure that looks like:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── app
</span></span><span style=display:flex><span>   ├── __init__.py
</span></span><span style=display:flex><span>   └── main.py
</span></span></code></pre></div><p>For good practice sake we start by creating a virtual environment to create an isolated environment for our FastAPI project.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=font-style:italic># Python 2:</span>
</span></span><span style=display:flex><span>$ virtualenv env
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># Python 3</span>
</span></span><span style=display:flex><span>$ python3 -m venv env
</span></span></code></pre></div><p>In order to use the environment’s packages/resources in isolation, you need to “activate” it. To do this, just run the following:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ source env/bin/activate
</span></span><span style=display:flex><span>(env) $
</span></span></code></pre></div><p>Now install FastAPI :</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pip install fastapi
</span></span></code></pre></div><p>You will also need an ASGI server, for production such as Uvicorn</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pip install <span style=font-style:italic>&#34;uvicorn[standard]&#34;</span>
</span></span></code></pre></div><p>Once installation is complete we are ready to build our application.</p><h2 id=creating-our-simple-posts-crud-application>Creating our simple POSTS crud application
<a class=heading-link href=#creating-our-simple-posts-crud-application><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Create a new file and call it main.py.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>touch main.py
</span></span></code></pre></div><p>Inside main.py:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>from</span> <span style=font-weight:700>fastapi</span> <span style=font-weight:700>import</span> FastAPI
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app = FastAPI()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>@app.get(<span style=font-style:italic>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> root():
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> {<span style=font-style:italic>&#34;Hello&#34;</span>: <span style=font-style:italic>&#34;World&#34;</span>}
</span></span></code></pre></div><p>Here we import FastAPI the Python class that provides all the functionality for your API, create a FastAPI application &ldquo;instance&rdquo;, define a single root path operation decorator that tells FastAPI that the function right below is in charge of handling requests that go to <code>/</code> using <code>get</code> operation and define a path operation function <code>root</code> which is a python function that is called by FastAPI whenever it receives a request to the URL <code>/</code> using a GET operation.. For a person coming from flask, the name path operations seemed very strange to me but this term is synonymous to routes ICYMI.</p><h3 id=run-the-app>Run the app
<a class=heading-link href=#run-the-app><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Run the server with:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ uvicorn main:app --reload
</span></span></code></pre></div><p>The command uvicorn main:app refers to:</p><ul><li><code>main</code>: the file <code>main.py</code> (the Python &ldquo;module&rdquo;).</li><li><code>app</code>: the object created inside of <code>main.py</code> with the line <code>app = FastAPI()</code>.</li><li><code>--reload</code>: make the server restart after code changes. Only do this for development.
If everything is okay one should get the following output</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
</span></span><span style=display:flex><span>INFO:     Started reloader process [28720]
</span></span><span style=display:flex><span>INFO:     Started server process [28722]
</span></span><span style=display:flex><span>INFO:     Waiting <span style=font-weight:700>for</span> application startup.
</span></span><span style=display:flex><span>INFO:     Application startup complete.
</span></span></code></pre></div><p>Head over to your browser at http://127.0.0.1:8000/ and you should see the JSON response</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{<span style=font-weight:700>&#34;Hello&#34;</span>: <span style=font-style:italic>&#34;World&#34;</span>}
</span></span></code></pre></div><p>Currently our API receives HTTP <code>GET</code> requests in the path <code>/</code> the goal however is to create a simple <code>CRUD</code> API. A CRUD app is a specific type of software application that consists of four basic operations; Create, Read, Update, Delete. We start by creating our dummy database which is a simple list of dictionaries to store posts.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-style:italic>#dummy in memory posts</span>
</span></span><span style=display:flex><span>posts = [{
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;title&#34;</span>: <span style=font-style:italic>&#34;title of post 1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;content&#34;</span>: <span style=font-style:italic>&#34;content of post 1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;id&#34;</span>: 1,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;published&#34;</span>: <span style=font-weight:700>True</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;rating&#34;</span>: 8
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;title&#34;</span>: <span style=font-style:italic>&#34;title of post 2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;content&#34;</span>: <span style=font-style:italic>&#34;content of post 2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;id&#34;</span>: 2,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;published&#34;</span>: <span style=font-weight:700>True</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;rating&#34;</span>: 6.5 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>For every dummy post we store:</p><ul><li><code>The title</code></li><li><code>The content</code></li><li><code>The ID</code></li><li><code>The published flag</code></li><li><code>The rating</code>
We then create a new path operation to view all posts</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-style:italic># get endpoint to get all posts</span>
</span></span><span style=display:flex><span>@app.get(<span style=font-style:italic>&#34;/posts&#34;</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> get_posts():
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> {<span style=font-style:italic>&#34;data&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;</span><span style=font-weight:700;font-style:italic>{</span>posts<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>}
</span></span></code></pre></div><p>we go ahead and create another path operation to create new posts. Here we need to send data from the client to our API. A <code>request body</code> is data sent by the client to your API. A <code>response body</code> is the data your API sends to the client. We leverage <code>pydantic</code> and use <code>python type annotations</code> put simply,We define how data(request and response body) should be in pure, canonical python and validate it with <code>pydantic</code>.
For this you declare your data model as a class that inherits from <code>BaseModel</code> and use standard Python types for all the attributes:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>from</span> <span style=font-weight:700>typing</span> <span style=font-weight:700>import</span> Optional
</span></span><span style=display:flex><span><span style=font-weight:700>from</span> <span style=font-weight:700>pydantic</span> <span style=font-weight:700>import</span> BaseModel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># request body pydantic model</span>
</span></span><span style=display:flex><span><span style=font-weight:700>class</span> <span style=font-weight:700>Post</span>(BaseModel):
</span></span><span style=display:flex><span>    title: str
</span></span><span style=display:flex><span>    content: str
</span></span><span style=display:flex><span>    published: bool = <span style=font-weight:700>True</span>
</span></span><span style=display:flex><span>    rating: Optional[int] = <span style=font-weight:700>None</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-style:italic># post endpoint to add a post</span>
</span></span><span style=display:flex><span>@app.post(<span style=font-style:italic>&#34;/posts&#34;</span>,status_code=status.HTTP_201_CREATED)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> create_posts(post:Post): 
</span></span><span style=display:flex><span>    last_id = int(posts[-1][<span style=font-style:italic>&#39;id&#39;</span>])
</span></span><span style=display:flex><span>    payload = post.dict()
</span></span><span style=display:flex><span>    payload[<span style=font-style:italic>&#34;id&#34;</span>] = last_id+1
</span></span><span style=display:flex><span>    posts.append(payload)
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> {<span style=font-style:italic>&#34;data&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;</span><span style=font-weight:700;font-style:italic>{</span>payload<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>}
</span></span></code></pre></div><p>We then get a single post by its ID and also get the latest post</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-style:italic># get endpoint to get a post by id as a path parameter</span>
</span></span><span style=display:flex><span>@app.get(<span style=font-style:italic>&#34;/posts/</span><span style=font-weight:700;font-style:italic>{post_id}</span><span style=font-style:italic>&#34;</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> get_post(post_id: int, response: Response):
</span></span><span style=display:flex><span>    post = find_post(post_id)
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> <span style=font-weight:700>not</span> post:
</span></span><span style=display:flex><span>        <span style=font-weight:700>raise</span> HTTPException(status_code=status.HTTP_404_NOT_FOUND,
</span></span><span style=display:flex><span>        detail=<span style=font-style:italic>f</span><span style=font-style:italic>&#34;post with id: </span><span style=font-weight:700;font-style:italic>{</span>post_id<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic> was not found&#34;</span>)
</span></span><span style=display:flex><span>        <span style=font-style:italic>#response.status_code = status.HTTP_404_NOT_FOUND</span>
</span></span><span style=display:flex><span>        <span style=font-style:italic>#return {&#34;message&#34;: }</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> {<span style=font-style:italic>&#34;data&#34;</span>:post}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-style:italic># get endpoint to get the latest post</span>
</span></span><span style=display:flex><span>@app.get(<span style=font-style:italic>&#34;/posts/latest&#34;</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> get_latest():
</span></span><span style=display:flex><span>    post = posts[len(posts)-1]
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> {<span style=font-style:italic>&#34;data&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;</span><span style=font-weight:700;font-style:italic>{</span>post<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>}
</span></span></code></pre></div><p>Update a single post by its id</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-style:italic># put endpoint to update a post</span>
</span></span><span style=display:flex><span>@app.put(<span style=font-style:italic>&#34;/posts/</span><span style=font-weight:700;font-style:italic>{post_id}</span><span style=font-style:italic>&#34;</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> update_post(post_id:int,post:Post):
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> <span style=font-weight:700>not</span> find_post(post_id):
</span></span><span style=display:flex><span>        <span style=font-weight:700>raise</span>(HTTPException(status_code=status.HTTP_404_NOT_FOUND,detail=<span style=font-style:italic>f</span><span style=font-style:italic>&#34;post with id: </span><span style=font-weight:700;font-style:italic>{</span>post_id<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic> was not found&#34;</span>))
</span></span><span style=display:flex><span>    <span style=font-weight:700>else</span>:
</span></span><span style=display:flex><span>        <span style=font-style:italic>#update the post</span>
</span></span><span style=display:flex><span>        <span style=font-weight:700>for</span> key,value <span style=font-weight:700>in</span> post.dict().items():
</span></span><span style=display:flex><span>            <span style=font-style:italic>#print(f&#34;{key} : {value}&#34;)</span>
</span></span><span style=display:flex><span>            posts[post_id-1][key] = value
</span></span><span style=display:flex><span>        <span style=font-weight:700>return</span>{<span style=font-style:italic>&#34;data&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;</span><span style=font-weight:700;font-style:italic>{</span>posts[post_id-1]<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>,<span style=font-style:italic>&#34;message&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;Successfully updated post wihth id </span><span style=font-weight:700;font-style:italic>{</span>post_id<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>}
</span></span></code></pre></div><p>The last piece of the crud is to Delete a post by its ID</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-style:italic># post end point to delete a post</span>
</span></span><span style=display:flex><span>@app.delete(<span style=font-style:italic>&#34;/posts/</span><span style=font-weight:700;font-style:italic>{post_id}</span><span style=font-style:italic>&#34;</span>,status_code=status.HTTP_204_NO_CONTENT)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> delete_post(post_id:int):
</span></span><span style=display:flex><span>    post = find_post(post_id)
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> <span style=font-weight:700>not</span> post:
</span></span><span style=display:flex><span>        <span style=font-weight:700>raise</span>(HTTPException(status_code=status.HTTP_404_NOT_FOUND,detail=<span style=font-style:italic>f</span><span style=font-style:italic>&#34;post with id: </span><span style=font-weight:700;font-style:italic>{</span>post_id<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic> was not found&#34;</span>))
</span></span><span style=display:flex><span>    <span style=font-weight:700>else</span>:
</span></span><span style=display:flex><span>        <span style=font-style:italic># delete the post</span>
</span></span><span style=display:flex><span>        posts.pop(post_id-1)
</span></span><span style=display:flex><span>        <span style=font-weight:700>return</span> Response(status_code=status.HTTP_204_NO_CONTENT)
</span></span></code></pre></div><p><code>main.py</code> looks like this at this point:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>from</span> <span style=font-weight:700>fastapi</span> <span style=font-weight:700>import</span> FastAPI,Response,status,HTTPException
</span></span><span style=display:flex><span><span style=font-weight:700>from</span> <span style=font-weight:700>fastapi.params</span> <span style=font-weight:700>import</span> Body
</span></span><span style=display:flex><span><span style=font-weight:700>from</span> <span style=font-weight:700>typing</span> <span style=font-weight:700>import</span> Optional
</span></span><span style=display:flex><span><span style=font-weight:700>from</span> <span style=font-weight:700>pydantic</span> <span style=font-weight:700>import</span> BaseModel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># aplication instance</span>
</span></span><span style=display:flex><span>app = FastAPI()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># request body pydantic model</span>
</span></span><span style=display:flex><span><span style=font-weight:700>class</span> <span style=font-weight:700>Post</span>(BaseModel):
</span></span><span style=display:flex><span>    title: str
</span></span><span style=display:flex><span>    content: str
</span></span><span style=display:flex><span>    published: bool = <span style=font-weight:700>True</span>
</span></span><span style=display:flex><span>    rating: Optional[int] = <span style=font-weight:700>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic>#dummy in memory posts</span>
</span></span><span style=display:flex><span>posts = [{
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;title&#34;</span>: <span style=font-style:italic>&#34;title of post 1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;content&#34;</span>: <span style=font-style:italic>&#34;content of post 1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;id&#34;</span>: 1,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;published&#34;</span>: <span style=font-weight:700>True</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;rating&#34;</span>: 8
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;title&#34;</span>: <span style=font-style:italic>&#34;title of post 2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;content&#34;</span>: <span style=font-style:italic>&#34;content of post 2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;id&#34;</span>: 2,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;published&#34;</span>: <span style=font-weight:700>True</span>,
</span></span><span style=display:flex><span>    <span style=font-style:italic>&#34;rating&#34;</span>: 6.5 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> find_post(id):
</span></span><span style=display:flex><span>    <span style=font-weight:700>for</span> i,post <span style=font-weight:700>in</span> enumerate(posts):
</span></span><span style=display:flex><span>        <span style=font-weight:700>if</span> post[<span style=font-style:italic>&#34;id&#34;</span>] == id:
</span></span><span style=display:flex><span>            <span style=font-weight:700>return</span> post
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic>#path operations - synonymous to routes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic>#root </span>
</span></span><span style=display:flex><span>@app.get(<span style=font-style:italic>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> root():
</span></span><span style=display:flex><span>    message = <span style=font-style:italic>&#34;Hello am learning FastAPI!!&#34;</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span>{<span style=font-style:italic>&#34;message&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;</span><span style=font-weight:700;font-style:italic>{</span>message<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># get endpoint to get all posts</span>
</span></span><span style=display:flex><span>@app.get(<span style=font-style:italic>&#34;/posts&#34;</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> get_posts():
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> {<span style=font-style:italic>&#34;data&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;</span><span style=font-weight:700;font-style:italic>{</span>posts<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># post endpoint to add a post</span>
</span></span><span style=display:flex><span>@app.post(<span style=font-style:italic>&#34;/posts&#34;</span>,status_code=status.HTTP_201_CREATED)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> create_posts(post:Post): 
</span></span><span style=display:flex><span>    last_id = int(posts[-1][<span style=font-style:italic>&#39;id&#39;</span>])
</span></span><span style=display:flex><span>    <span style=font-style:italic>#print(last_id)</span>
</span></span><span style=display:flex><span>    payload = post.dict()
</span></span><span style=display:flex><span>    payload[<span style=font-style:italic>&#34;id&#34;</span>] = last_id+1
</span></span><span style=display:flex><span>    <span style=font-style:italic>#print(payload)</span>
</span></span><span style=display:flex><span>    posts.append(payload)
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> {<span style=font-style:italic>&#34;data&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;</span><span style=font-weight:700;font-style:italic>{</span>payload<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># get endpoint to get the latest post</span>
</span></span><span style=display:flex><span>@app.get(<span style=font-style:italic>&#34;/posts/latest&#34;</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> get_latest():
</span></span><span style=display:flex><span>    post = posts[len(posts)-1]
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> {<span style=font-style:italic>&#34;data&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;</span><span style=font-weight:700;font-style:italic>{</span>post<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># get endpoint to get a post by id as a path parameter</span>
</span></span><span style=display:flex><span>@app.get(<span style=font-style:italic>&#34;/posts/</span><span style=font-weight:700;font-style:italic>{post_id}</span><span style=font-style:italic>&#34;</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> get_post(post_id: int, response: Response):
</span></span><span style=display:flex><span>    post = find_post(post_id)
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> <span style=font-weight:700>not</span> post:
</span></span><span style=display:flex><span>        <span style=font-weight:700>raise</span> HTTPException(status_code=status.HTTP_404_NOT_FOUND,
</span></span><span style=display:flex><span>        detail=<span style=font-style:italic>f</span><span style=font-style:italic>&#34;post with id: </span><span style=font-weight:700;font-style:italic>{</span>post_id<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic> was not found&#34;</span>)
</span></span><span style=display:flex><span>        <span style=font-style:italic>#response.status_code = status.HTTP_404_NOT_FOUND</span>
</span></span><span style=display:flex><span>        <span style=font-style:italic>#return {&#34;message&#34;: }</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> {<span style=font-style:italic>&#34;data&#34;</span>:post}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># post end point to delete a post</span>
</span></span><span style=display:flex><span>@app.delete(<span style=font-style:italic>&#34;/posts/</span><span style=font-weight:700;font-style:italic>{post_id}</span><span style=font-style:italic>&#34;</span>,status_code=status.HTTP_204_NO_CONTENT)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> delete_post(post_id:int):
</span></span><span style=display:flex><span>    post = find_post(post_id)
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> <span style=font-weight:700>not</span> post:
</span></span><span style=display:flex><span>        <span style=font-weight:700>raise</span>(HTTPException(status_code=status.HTTP_404_NOT_FOUND,detail=<span style=font-style:italic>f</span><span style=font-style:italic>&#34;post with id: </span><span style=font-weight:700;font-style:italic>{</span>post_id<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic> was not found&#34;</span>))
</span></span><span style=display:flex><span>    <span style=font-weight:700>else</span>:
</span></span><span style=display:flex><span>        <span style=font-style:italic># delete the post</span>
</span></span><span style=display:flex><span>        posts.pop(post_id-1)
</span></span><span style=display:flex><span>        <span style=font-weight:700>return</span> Response(status_code=status.HTTP_204_NO_CONTENT)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># put endpoint to update a post</span>
</span></span><span style=display:flex><span>@app.put(<span style=font-style:italic>&#34;/posts/</span><span style=font-weight:700;font-style:italic>{post_id}</span><span style=font-style:italic>&#34;</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> update_post(post_id:int,post:Post):
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> <span style=font-weight:700>not</span> find_post(post_id):
</span></span><span style=display:flex><span>        <span style=font-weight:700>raise</span>(HTTPException(status_code=status.HTTP_404_NOT_FOUND,detail=<span style=font-style:italic>f</span><span style=font-style:italic>&#34;post with id: </span><span style=font-weight:700;font-style:italic>{</span>post_id<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic> was not found&#34;</span>))
</span></span><span style=display:flex><span>    <span style=font-weight:700>else</span>:
</span></span><span style=display:flex><span>        <span style=font-style:italic>#update the post</span>
</span></span><span style=display:flex><span>        <span style=font-weight:700>for</span> key,value <span style=font-weight:700>in</span> post.dict().items():
</span></span><span style=display:flex><span>            <span style=font-style:italic>#print(f&#34;{key} : {value}&#34;)</span>
</span></span><span style=display:flex><span>            posts[post_id-1][key] = value
</span></span><span style=display:flex><span>        <span style=font-weight:700>return</span>{<span style=font-style:italic>&#34;data&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;</span><span style=font-weight:700;font-style:italic>{</span>posts[post_id-1]<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>,<span style=font-style:italic>&#34;message&#34;</span>:<span style=font-style:italic>f</span><span style=font-style:italic>&#34;Successfully updated post wihth id </span><span style=font-weight:700;font-style:italic>{</span>post_id<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>}
</span></span></code></pre></div><p>Once our application is done we export our virtual environment dependencies to a <code>requirements.txt</code> file by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pip freeze &gt; requirements.txt
</span></span></code></pre></div><h2 id=docker>Docker
<a class=heading-link href=#docker><i class="fa fa-link" aria-hidden=true></i></a></h2><figure><img src=/fastapi-docker/docker.png alt=docker></figure><h2 id=what-is-docker>What is Docker
<a class=heading-link href=#what-is-docker><i class="fa fa-link" aria-hidden=true></i></a></h2><p><code>Docker</code> is a tool that makes it easier to create, deploy, and run applications using <code>containers</code>.With Docker you can easily deploy a web application along with its dependencies, environment variables, and configuration settings - everything you need to recreate your environment quickly and efficiently.</p><p>A <code>docker container</code> is a collection of dependencies and code organised as software that enables applications to run quickly and efficiently in a range of computing environments.</p><p>A <code>docker image</code>, on the other hand, is a blueprint that specifies how to run an application. In order for Docker to build images automatically, a set of instructions must be stored in a special file known as a <code>Dockerfile</code>.</p><p>The instructions in this file are executed by the user on the command line interface in order to create an image.<figure><img src=/fastapi-docker/docker2.jpeg alt=docker></figure></p><h2 id=docker-setup-and-installation>Docker Setup and Installation
<a class=heading-link href=#docker-setup-and-installation><i class="fa fa-link" aria-hidden=true></i></a></h2><p>There are two main Docker tools to be installed: Docker (CLI) and Docker Compose. Note that I am running on an Ubuntu 18.04.6 LTS system however installation instructions for other operating systems can be found <a href=https://docs.docker.com/engine/install/>here</a>.</p><h3 id=uninstall-older-versions>Uninstall older versions
<a class=heading-link href=#uninstall-older-versions><i class="fa fa-link" aria-hidden=true></i></a></h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt-get remove docker docker-engine docker.io containerd runc
</span></span></code></pre></div><p>Update the <code>apt</code> package index and install packages to allow apt to use a repository over HTTPS</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install  ca-certificates curl gnupg lsb-release
</span></span></code></pre></div><h3 id=add-dockers-official-gpg-key>Add Docker’s official GPG key:
<a class=heading-link href=#add-dockers-official-gpg-key><i class="fa fa-link" aria-hidden=true></i></a></h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
</span></span></code></pre></div><h3 id=install-docker-engine>Install Docker Engine
<a class=heading-link href=#install-docker-engine><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Update the <code>apt</code> package and install the latest version of <code>Docker Engine</code> and <code>containerd</code></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt-get update
</span></span><span style=display:flex><span>$ sudo apt-get install docker-ce docker-ce-cli containerd.io
</span></span></code></pre></div><h3 id=executing-the-docker-command-without-sudo-optional>Executing the Docker Command Without Sudo (Optional)
<a class=heading-link href=#executing-the-docker-command-without-sudo-optional><i class="fa fa-link" aria-hidden=true></i></a></h3><p>I found it annoying running the <code>docker</code> command as <code>root</code> this is the default behaviour to change this add your username to the docker group:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo usermod -aG docker <span style=font-weight:700;font-style:italic>${</span>USER<span style=font-weight:700;font-style:italic>}</span>
</span></span></code></pre></div><p>For the changes to take effect reboot your machine</p><h2 id=using-dockerfiles>Using Dockerfiles
<a class=heading-link href=#using-dockerfiles><i class="fa fa-link" aria-hidden=true></i></a></h2><p><code>Docker</code> can build images automatically by reading the instructions from a <code>Dockerfile</code>. A <code>Dockerfile</code> is a text document that contains all the commands a user could call on the command line to assemble an image. Using docker build users can create an automated build that executes several command-line instructions in succession.A <code>Dockerfile</code> adheres to a specific format and set of instructions which you can find at <a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/>Dockerfile reference</a>.</p><h2 id=the-dockerfile>The Dockerfile
<a class=heading-link href=#the-dockerfile><i class="fa fa-link" aria-hidden=true></i></a></h2><p>We create our <code>Dockerfile</code> at the root of our working directory, and add the following instructions to it :</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=font-weight:700>FROM</span><span style=font-style:italic> python:3.6</span><span>
</span></span></span><span style=display:flex><span><span></span><span style=font-weight:700>WORKDIR</span><span style=font-style:italic> /fastapi</span><span>
</span></span></span><span style=display:flex><span><span></span><span style=font-weight:700>COPY</span> requirements.txt /fastapi<span>
</span></span></span><span style=display:flex><span><span></span><span style=font-weight:700>RUN</span> pip install -r requirements.txt<span>
</span></span></span><span style=display:flex><span><span></span><span style=font-weight:700>COPY</span> ./app /fastapi/app<span>
</span></span></span><span style=display:flex><span><span></span><span style=font-weight:700>CMD</span> [<span style=font-style:italic>&#34;uvicorn&#34;</span>, <span style=font-style:italic>&#34;app.main:app&#34;</span>, <span style=font-style:italic>&#34;--host&#34;</span>, <span style=font-style:italic>&#34;0.0.0.0&#34;</span>, <span style=font-style:italic>&#34;--port&#34;</span>, <span style=font-style:italic>&#34;80&#34;</span>]<span>
</span></span></span></code></pre></div><p>Here&rsquo;s what each instruction means:</p><ol><li><code>FROM</code> specifies the parent image <code>Python:3.6</code> from which you are building</li><li><code>WORKDIR</code> sets the current working directory to /fastapi for any <code>RUN</code>, <code>CMD</code>,<code>COPY</code> and <code>ADD</code> instructions that follow it in the <code>Dockerfile</code>.</li><li><code>COPY</code> Copies the file with the requirements to the /fastapi directory.</li><li>Install the package dependencies in the requirements file.</li><li>Copy the ./app local source directory to the working directory.</li><li><code>CMD</code> specifies what command to run within the container.The main purpose of a <code>CMD</code> is to provide defaults for an executing container.In this case it runs the uvicorn server.There can only be one <code>CMD</code> instruction in a <code>Dockerfile</code>. If you list more than one <code>CMD</code> then only the last <code>CMD</code> will take effect.</li></ol><h3 id=run-and-cmd><code>Run</code> and <code>cmd</code>
<a class=heading-link href=#run-and-cmd><i class="fa fa-link" aria-hidden=true></i></a></h3><p><code>RUN</code> actually runs a command and commits the result; <code>CMD</code> does not execute anything at build time, but specifies the intended command for the image.</p><p>Here is how your project directory should look like:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── app
</span></span><span style=display:flex><span>│   ├── __init__.py
</span></span><span style=display:flex><span>│   └── main.py
</span></span><span style=display:flex><span>├── Dockerfile
</span></span><span style=display:flex><span>├── requirements.txt
</span></span><span style=display:flex><span>└── env
</span></span></code></pre></div><h3 id=build-the-image>Build the image
<a class=heading-link href=#build-the-image><i class="fa fa-link" aria-hidden=true></i></a></h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker build -t fastapi_learn .
</span></span></code></pre></div><h3 id=launch-the-container>Launch the container
<a class=heading-link href=#launch-the-container><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Run a container based on your image:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker run -d -p 8000:80 fastapi_learn
</span></span></code></pre></div><p>once again if we visit http://127.0.0.1:8000/ we get:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{<span style=font-weight:700>&#34;message&#34;</span>: <span style=font-style:italic>&#34;Hello am learning FastAPI!!&#34;</span>}
</span></span></code></pre></div><figure><img src=/fastapi-docker/browser1.png alt=fastapi></figure><h2 id=interactive-docs>Interactive Docs
<a class=heading-link href=#interactive-docs><i class="fa fa-link" aria-hidden=true></i></a></h2><p>As mentioned FastAPI autogenerates docs for your api to test this out navigate to: http://127.0.0.1:8000/docs</p><h3 id=swagger-ui>Swagger ui
<a class=heading-link href=#swagger-ui><i class="fa fa-link" aria-hidden=true></i></a></h3><p><figure><img src=/fastapi-docker/browser2.png alt=fastapi></figure>and http://127.0.0.1:8000/redoc for the alternative documentation:</p><h3 id=redoc>ReDoc
<a class=heading-link href=#redoc><i class="fa fa-link" aria-hidden=true></i></a></h3><figure><img src=/fastapi-docker/browser3.png alt=fastapi></figure></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2022
Daniel Chege Nduati
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script>
<script data-goatcounter=https://daniel.goatcounter.com/count async src=//gc.zgo.at/count.js></script></body></html>